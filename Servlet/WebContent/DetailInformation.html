<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>详细信息</title>
    <script src="china.js"></script>
    <script src="echarts.js"></script>
    <script src="echarts.min.js"></script>
    <script src="jquery-3.4.1.min.js"></script>
    <link type="text/css" rel="stylesheet" href="DetailInformation.css"/>
</head>
<body>
<!-- 为ECharts准备一个具备大小（宽高）的Dom -->
<div id="main" style="width: 800px;;height:600px; display: block;"></div>
<div class="top">
    <h1 id="title"></h1>
    <div id="table">
    <a class="left" id="left">更新至</a>
    <a class="right">数据说明</a>
    <table>
        <tr>
            <td class="row1">现有确诊</td>
            <td class="row1">累计确诊</td>
            <td class="row1">累计治愈</td>
            <td class="row1">累计死亡</td>
        </tr>
        <tr>
            <td class="td" id="td1">55555</td>
            <td class="td" id="td2">5555</td>
            <td class="td" id="td3">555</td>
            <td class="td" id="td4">55</td>
        </tr>
        <tr>
            <td>昨日<a class="td1">555</a></td>
            <td>昨日<a class="td2">55</a></td>
            <td>昨日<a class="td3">55</a></td>
            <td>昨日<a class="td4">5</a></td>
        </tr>
    </table>
    </div>
</div>
<div class="content">
    <div class="tab-content" id="content1" style="height: 500px;width: 800px">
    </div>
    <div class="tab-content" id="content2" style="display: none;height: 500px;width: 800px">
    </div>
    <div class="tab-content" id="content3" style="display: none;height: 500px;width: 800px">
    </div>
</div>
<div class="tab-ui">
    <div class="tab">
        <div class="tab-title tab-title-active" id="tab1" onclick="show(3,1)">
            <a>新增确诊趋势</a>
        </div>
        <div class="tab-title" id="tab2" onclick="show(3,2)">
            <a>累计确诊趋势</a>
        </div>
        <div class="tab-title" id="tab3" onclick="show(3,3)">
            <a>累计治愈/死亡</a>
        </div>
    </div>
</div>
<script type="text/javascript">
function getQueryVariable(variable)
{
       var query = window.location.search.substring(1);
       var vars = query.split("?");
       for (var i=0;i<vars.length;i++) {
               var pair = vars[i].split("=");
               if(pair[0] == variable){return pair[1];}
       }
       return(false);
}


window.onload=function(){
	
	//alert(decodeURI(getQueryVariable("name")));
	var title=document.createElement("a");
    title.text=decodeURI(getQueryVariable("name"));
    var two=document.getElementById("title");
    two.appendChild(title);
    
    
	var mydata2 = new Array(0);
    $.ajax({
    	url : "InfoServlet?method=crawl2",
    	async : true,
    	type : "POST",
    	data : {
            
        },
    	success : function(data){
    		var json = eval("(" + data + ")");//data为接收的后台返回的数据；
        	//alert(json.length);
        	mydata2 = [];
            for (var i = 0; i < json.length; i++) {
                console.log(json[i]);
            }

            var myChart1 = echarts.init(document.getElementById('content1'));
            option = {
                xAxis: {
                    type: 'category',
                    data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
                },
                yAxis: {
                    type: 'value'
                },
                series: [{
                    data: [820, 932, 901, 934, 1290, 1330, 1320],
                    type: 'line'
                }]
            };
            myChart1.setOption(option);

        var myChart2 = echarts.init(document.getElementById('content2'));
        option = {
        xAxis: {
            type: 'category',
            data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
        },
        yAxis: {
            type: 'value'
        },
        series: [{
            data: [820, 932, 901, 934, 1290, 1330, 1320],
            type: 'line'
        }]
    };
    myChart2.setOption(option);


            
            
            var myChart3 = echarts.init(document.getElementById('content3'));
            option = {
                xAxis: {
                    type: 'category',
                    data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
                },
                yAxis: {
                    type: 'value'
                },
                series: [{
                    data: [820, 932, 901, 934, 1290, 1330, 1320],
                    type: 'line'
                }]
            };
            myChart3.setOption(option);
    	},
    	error : function() {
        	alert("请求失败");
    	},
    });
} 




        /**
         * format=1表示获取年月日
         * format=0表示获取年月日时分秒
         * **/
        var now = new Date();
        var year = now.getFullYear();
        var month = now.getMonth()+1;
        var date = now.getDate();
        var day = now.getDay();//得到周几
        var hour = now.getHours();//得到小时
        var minu = now.getMinutes();//得到分钟
        var sec = now.getSeconds();//得到秒
        _time = year+"-"+month+"-"+date+" "+hour+":"+minu+":"+sec;
        var left=document.getElementById('left');
        var a=document.createElement("a");
        a.text=_time;
        left.appendChild(a);

		

    
    function show(total,active){
        for(var i=1;i<total+1;i++){
            $("#tab"+i).removeClass("tab-title-active");
            $("#content"+i).hide();
        }
        $("#tab"+active).addClass("tab-title-active");
        $("#content"+active).show();
    }
</script>
<script>

    var myChart = echarts.init(document.getElementById('main'));
    //myChart.showLoading();
    var province = "${province}";
    //var list = "${list}";


    $.get("mapjson/"+ province +".json", function (geoJson) {

        myChart.hideLoading();

        echarts.registerMap(province, geoJson);

        myChart.setOption(option = {
            title: {
                text: province + '地区疫情情况',
            },
            tooltip: {
                trigger: 'item',
                formatter: '{b}<br/>{c} (确诊 / 人)'
            },
            toolbox: {
                show: true,
                orient: 'vertical',
                left: 'right',
                top: 'center',
                feature: {
                    dataView: {readOnly: false},
                    restore: {},
                    saveAsImage: {}
                }
            },
            visualMap: {
                min: 0,
                max: 50000,
                text: ['High', 'Low'],
                inRange: {
                    color: ['lightskyblue', 'yellow', 'orangered']
                }
            },
            series: [
                {
                    name: province + '地区疫情情况',
                    type: 'map',
                    mapType: province, // 自定义扩展图表类型
                    label: {
                        show: true
                    }
                }
            ]
        });
    });



    $.ajax({
        url:"info?method=d",
        async:true,
        type:"POST",
        data:{"province":province},
        success:function(data){
            alert(data.length);
            var mydata1 = new Array(0);
            for(var i=0;i<data.length;i++){
                var c = {};
                c["name"] = data[i].name+'市';
                c["value"] = data[i].value;
                mydata1.push(c);
            }
            myChart.setOption({        //加载数据图表
                series: [{
                    data: mydata1
                }]
            });
        },
        error:function(){
            alert("请求失败");
        },
        dataType:"json"
    });




</script>
</body>
</html>